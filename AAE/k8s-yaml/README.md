# Deploying with Kubernetes YAML

Extract the helm chart from ibm-dba-aae-prod-1.0.0.tgz and copy to your installation directory.


## Installing the Chart

To use the Kubernetes command line to install the chart with release name `my-release`

* Run the following command:

  ```
  helm template --name my-release ibm-dba-aae-prod --namespace <namespace> --output-dir ./yamls -f my-values.yaml
  ```

  If the directory `/yamls` does not exist, you can create it by running `mkdir yamls`.
  
  The command deploys `ibm-dba-aae-prod` onto the Kubernetes cluster, based on the values specified in the `my-values.yaml` file. If you use [App Engine platform helm install helper script](configuration) before, you can use ./aae-helper/templates/updateValues.yaml file generated by the script.The configuration section lists the parameters that can be configured during installation.

* Customize the yamls directory by running the following commands:

  ```
  rm -rf ./yamls/ibm-dba-aae-prod/charts/appengine/templates/tests
  rm -rf ./yamls/ibm-dba-aae-prod/charts/resourceRegistry/templates/tests
  ```

* Search `runAsUser: 50001` in the generated contents. And delete them all. (This step can be avoid after helm new feature added).

* Apply the customization to the server by running the following command:

    kubectl apply -R -f ./yamls

### Verifying the Chart

1. After the installation is finished, see the instructions for verifying the chart by running the following command:

    `helm status my-release --tls`

2. Get the name of the pods that were deployed with ibm-dba-aae-prod by running the following command:

    `kubectl get pod -n <namespace>`

3. For each pod, check under Events to see that the images were successfully pulled and the containers were created and started, by running the following command with the specific pod name:

    `kubectl describe pod <pod name> -n <namespace>`

4. Go to `https://<hostname>` in your browser (if you set up App Engine with Route) or `https://<hostname>:<NodePort>` (if you  set up App Engine with NodePort).
  
### Uninstalling the Chart
To uninstall and delete the my-release deployment, run the following command:

    `kubectl delete -R -f ./yamls`

This command removes all the Kubernetes components associated with the chart and deletes the release. If a delete can result in orphaned components, you must delete them manually.

For example, when you delete a release with stateful sets, the associated persistent volume must be deleted. Run the following command after deleting the chart release to clean up orphaned persistent volumes:

    kubectl delete pvc -l release=my-release
