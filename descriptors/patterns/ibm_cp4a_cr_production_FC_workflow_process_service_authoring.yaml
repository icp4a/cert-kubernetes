###############################################################################
#
# Licensed Materials - Property of IBM
#
# (C) Copyright IBM Corp. 2022, 2023. All Rights Reserved.
#
# US Government Users Restricted Rights - Use, duplication or
# disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
#
###############################################################################
apiVersion: icp4a.ibm.com/v1
kind: ICP4ACluster
metadata:
  name: icp4adeploy
  labels:
    app.kubernetes.io/instance: ibm-dba
    app.kubernetes.io/managed-by: ibm-dba
    app.kubernetes.io/name: ibm-dba
    release: 24.0.0
spec:
  appVersion: 24.0.0

  ## MUST exist, used to accept ibm license, valid value only can be "accept"
  ibm_license: ""

  ##########################################################################
  ## This section contains the shared configuration for all CP4A components #
  ##########################################################################
  shared_configuration:

    ## FileNet Content Manager (FNCM) license and possible values are: user, non-production, and production.
    ## This value could be different from the other licenses in the CR.
    sc_deployment_fncm_license: "<Required>"


    ## Use this parameter to specify the license for the CP4A deployment and
    ## the possible values are: non-production and production and if not set, the license will
    ## be defaulted to production.  This value could be different from the other licenses in the CR.
    sc_deployment_license: "<Required>"

    ## All CP4A components must use/share the image_pull_secrets to pull images
    image_pull_secrets:
    - ibm-entitlement-key

    ## All CP4A components must use/share the same docker image repository.  For example, if IBM Entitled Registry is used, then
    ## it should be "cp.icr.io".  Otherwise, it will be a local docker registry.
    sc_image_repository: cp.icr.io

    ## If your Openshift cluster is configured for Hugepages and you want the applicable deployment resources to consume Hugepages.
    ## You must set "true" for sc_hugepages.enabled. Default is "false".
    ## You must set type for "Hugepages" like hugepages-2Mi or hugepages-1Gi. Default is "hugepages-2Mi".
    ## You must set size for value which is suitable for Openshift cluster.
    sc_hugepages:
      enabled: false
      type: ""
      value: ""

    ## This optional property is a string value corresponding to the “ipFamilyPolicy” property of the Kubernetes “service” object.
    ## This setting becomes particularly relevant in dual-stack environments where both IPv4 and IPv6 are enabled.
    ## Here are the options you can specify for ipFamilyPolicy: SingleStack , PreferDualStack , RequireDualStack
    ## Only set this property if you want the “ipFamilyPolicy” property of the services created for CP4BA to be configured differently from the cluster-level settings.
    ## Warning: Setting this property to a value not supported by your cluster will cause CP4BA deployment to fail.
    sc_service_ip_family_policy:

    ## This optional property is a list value corresponding to the “ipFamilies” property of the Kubernetes “service” object.
    ## This parameter works in conjunction with the ipFamilyPolicy to define the IP addressing behaviors for the Service.
    ## You can set it to any of the following array values: ["IPv4"],["IPv6"],["IPv4","IPv6"] (dual-stack environment)
    ## Only set this property if you want the “ipFamilies” property of the services created for CP4BA to be configured differently from the cluster-level settings.
    ## Warning: Setting this property to a value not supported by your cluster will cause CP4BA deployment to fail.
    sc_service_ip_families:

    ## Specify the RunAsUser for the security context of the pod.  This is usually a numeric value that corresponds to a user ID.
    ## For non-OCP (e.g., CNCF platforms such as AWS, GKE, etc), this parameter is optional. It is not supported on OCP and ROKS.
    sc_run_as_user:

    ## Optional setting for secure computing mode (seccomp) profile for CP4A containers.  The default seccomp profile is RuntimeDefault on OCP 4.11 (k8s v1.24) or higher. seccomp profile won't be created on OCP 4.10 (k8s v1.23) or lower.
    ## For more information on seccomp please refer to https://kubernetes.io/docs/tutorials/security/seccomp/ and https://docs.openshift.com/container-platform/4.12/security/seccomp-profiles.html
    ## NOTE: Defining a custom, localhost seccomp profile that is stricter than the default RuntimeDefault profile may cause our pods fail to start.  This custom profile should be created at the worker nodes.
    sc_seccomp_profile:
    #  type: # RuntimeDefault, Localhost, Unconfined
    #  localhost_profile: # Local path of custom seccomp profile when type `Localhost` is used. The custom profile must be accessible by the pod and must exist locally on all worker nodes.  For example: `/profiles/fine-grained.json`.

    images:
      keytool_job_container:
        repository: cp.icr.io/cp/cp4a/baw/dba-keytool-jobcontainer
        tag: "24.0.0-IF001"
      dbcompatibility_init_container:
        repository: cp.icr.io/cp/cp4a/baw/dba-dbcompatibility-initcontainer
        tag: "24.0.0-IF001"
      keytool_init_container:
        repository: cp.icr.io/cp/cp4a/baw/dba-keytool-initcontainer
        tag: "24.0.0-IF001"
      umsregistration_initjob:
        repository: cp.icr.io/cp/cp4a/baw/dba-umsregistration-initjob
        tag: "24.0.0-IF001"

      ## All CP4A components should use this pull_policy as the default, but it can override by each component
      pull_policy: IfNotPresent

    ## All CP4A components must use/share the root_ca_secret in order for integration
    root_ca_secret: icp4a-root-ca

    ## Shared secret containing a wildcard certificate (and concatenated signers) to be used by all routes, unless overwritten for a specific component route.
    ## If this is not defined, all external routes will be signed with root_ca_secret.
    external_tls_certificate_secret:

    ## CP4A patterns or capabilities to be deployed.  This CR represents the "workflow-process-service" pattern, which includes the following
    ## mandatory components: bas(Business Automation Studio) and optional components: bai,pfs,kafka
    sc_deployment_patterns: workflow-process-service

    ## The optional components to be installed if listed here.  This is normally populated by the User script based on input from the user.
    ## The optional components are: bai,pfs,kafka. Please do not delete wfps_authoring, because it determines that this is an Authoring environment.
    ## pfs will bring advanced full text search function to workplace. And the external workplace can be enabled only when pfs is enabled
    ## kafka will install a kafka cluster and enable kafka service for workflow process service authoring
    sc_optional_components: wfps_authoring

    ## The deployment type as selected by the user.  Possible values are: Starter and Production.
    sc_deployment_type: Production

    ## The deployment context, which has a default value of "CP4A".  Unless you are instructed to change this value or
    ## know the reason to change this value, please leave the default value.
    sc_deployment_context: "CP4A"

    ## The platform to be deployed specified by the user.  Possible values are: OCP and other.  This is normally populated by the User script
    ## based on input from the user.
    sc_deployment_platform:

    sc_egress_configuration:
      ## Required. Enable or disable egress access to external systems.
      ## If "sc_restricted_internet_access" is defined and has no value set, then default will be "true".
      ## If "sc_restricted_internet_access" is not defined (e.g., in the case of upgrade, the existing CR will not have sc_restricted_internet_access), then "sc_restricted_internet_access" will be "false"
      sc_restricted_internet_access: true
      ## Optional.  Kubernetes API server namespace(s) (comma separated) to be used for egress network policy when `sc_restricted_internet_access: true` and `sc_deployment_platform: "other"`.
      ## "{}" can also be used as a value.  It is equivalent to all namespaces (eg: namespaceSelector:{})
      ## Default are "openshift-kube-apiserver", "openshift-apiserver" for OCP and ROKS.
      sc_api_namespace:
      ## Optional.  Kubernetes API server port(s) (comma separated) to be used for egress network policy when `sc_restricted_internet_access: true` and `sc_deployment_platform: "other"`.
      ## Default are 443,6443 for OCP and ROKS
      sc_api_port:
      ## Optional.  Kubernetes DNS service namespace(s) (comma separated) to be used for egress network policy when `sc_restricted_internet_access: true` and `sc_deployment_platform: "other"`.
      ## "{}" can also be used as a value.  It is equivalent to all namespaces (eg: namespaceSelector:{})
      ## Default is "openshift-dns" for OCP and ROKS
      sc_dns_namespace:
      ## Optional.  Kubernetes DNS service port(s) (comma separated) to be used for egress network policy when `sc_restricted_internet_access: true` and `sc_deployment_platform: "other"`.
      ## Default are 53,5353 for OCP and ROKS
      sc_dns_port:

    ## For OCP, this is used to create route, you should input a valid hostname in the required field.


    ## For ROKS, this is used to enable the creation of ingresses. The default value is "false", which routes will be created.
    sc_ingress_enable: false

    ## For ROKS Ingress, provide TLS secret name for Ingress controller. If you are not using ROKS, comment out this line.
    sc_ingress_tls_secret_name: <Required>

    ## If the root certificate authority (CA) key of the external service is not signed by the operator root CA key, provide the TLS certificate of
    ## the external service to the component's truststore.
    trusted_certificate_list: []

    ## This is necessary if you want to use your own JDBC drivers and/or need to provide ICCSAP drivers.  If you are providing multiple JDBC drivers and ICCSAP drivers,
    ## all the files must be compressed in a single file.
    ## First you need to package your drivers into a compressed package in the format of "saplibs/drivers_files" and/or
    ## "jdbc/db2|oracle|postgresql|sqlserver/driver_files". For example, if you are providing your own DB2 and Oracle JDBC drivers and ICCSAP drivers, then the compressed
    ## file should have the following structure and content:
    ##   /jdbc/db2/db2jcc4.jar
    ##   /jdbc/db2/db2jcc_license_cu.jar
    ##   /jdbc/oracle/ojdbc8.jar
    ##   /saplibs/libicudata.so.50
    ##   /saplibs/...
    ## Then you need to put the compressed package on an anonymously accessible web server and provide the link here.
    ## The CR can handle .zip files using unzip as well as .tar, .tar.gz, .tar.bz2, .tar.xz. Does not handle .gz files, .bz2 files, .xz, or .zst files that do not contain a .tar archive.
    sc_drivers_url:

    ## Shared encryption key secret name that is used for Workflow or Workstream Services and Process Federation Server integration.
    ## This secret is also used by Workflow and BAStudio to store AES encryption key.
    encryption_key_secret: ibm-iaws-shared-key-secret

    ## Enable/disable ECM (FNCM) / BAN initialization (e.g., creation of P8 domain, creation/configuration of object stores,
    ## creation/configuration of CSS servers, and initialization of Navigator (ICN)).  If the "initialize_configuration" section
    ## is defined with the required parameters in the CR (below) and sc_content_initialization is set to "true" (or the parameter doesn't exist), then the initialization will occur.
    ## However, if sc_content_initialization is set to "false", then the initialization will not occur (even with the "initialize_configuration" section defined)
    ## For Workflow Authoring, by default sc_content_initialization is set to "true" with "initialize_configuration"section filled.
    ## If you already initialized content or want to upgrade, please set sc_content_initialization to "false" before you apply the CR.
    sc_content_initialization: true

    ## Enable/disable the ECM (FNCM) / BAN verification (e.g., creation of test folder, creation of test document,
    ## execution of CBR search, and creation of Navigator demo repository and desktop).  If the "verify_configuration"
    ## section is defined in the CR and sc_content_verification is set to true, then the verification will occur.  Note that if you are upgrading or
    ## migrating, set this parameter to "false" since the env has been previously verified.
    sc_content_verification: false

    ## On OCP 3.x and 4.x, the User script will populate these three (3) parameters based on your input for "production" deployment.
    ## If you manually deploying without using the User script, then you would provide the different storage classes for the slow, medium
    ## and fast storage parameters below.  If you only have 1 storage class defined, then you can use that 1 storage class for all 3 parameters.
    ## sc_block_storage_classname is for Zen, Zen requires/recommends block storage (RWO) for metastoreDB
    storage_configuration:
      sc_slow_file_storage_classname: "<Required>"
      sc_medium_file_storage_classname: "<Required>"
      sc_fast_file_storage_classname: "<Required>"
      sc_block_storage_classname: "<Required>"

    ## Enable/disable FIPS mode for the deployment (default value is "false")
    ## Note: If set as "true", in order to complete enablement of FIPS for CP4BA, please refer to "FIPS wall" configuration in IBM documentation.
    enable_fips: false

    ## If a cluster is configured for multiple availability zones (AZ) and the parameter sc_is_multiple_az is set to true, then the pods are spread across all the zones.
    ## By default, the sc_is_multiple_az parameter is set to false. When the value is set to true, the pods of the CP4BA deployment are spread across your user-defined topology domains.
    ## The pod API includes a spec.topologySpreadConstraints field, which is used by the CP4BA operator to configure it.
    sc_is_multiple_az: false

  ## The beginning section of LDAP configuration for CP4A
  ldap_configuration:
    ## The possible values are: "IBM Security Directory Server" or "Microsoft Active Directory" or "Custom"
    lc_selected_ldap_type: "<Required>"

    ## The name of the LDAP server to connect
    lc_ldap_server: "<Required>"

    ## The port of the LDAP server to connect.  Some possible values are: 389, 636, etc.
    lc_ldap_port: "<Required>"

    ## The LDAP bind secret for LDAP authentication.  The secret is expected to have ldapUsername and ldapPassword keys.  Refer to Knowledge Center for more info.
    lc_bind_secret: ldap-bind-secret

    ## The LDAP base DN.  For example, "dc=example,dc=com", "dc=abc,dc=com", etc
    lc_ldap_base_dn: "<Required>"

    ## Enable SSL/TLS for LDAP communication. Refer to Knowledge Center for more info.
    lc_ldap_ssl_enabled: true

    ## The name of the secret that contains the LDAP SSL/TLS certificate.
    lc_ldap_ssl_secret_name: "<Required>"

    ## The LDAP user name attribute. Semicolon-separated list that must include the first RDN user distinguished names. One possible value is "*:uid" for TDS and "user:sAMAccountName" for AD. Refer to Knowledge Center for more info.
    lc_ldap_user_name_attribute: "<Required>"

    ## The LDAP user display name attribute. One possible value is "cn" for TDS and "sAMAccountName" for AD. Refer to Knowledge Center for more info.
    lc_ldap_user_display_name_attr: "<Required>"

    ## The LDAP group base DN.  For example, "dc=example,dc=com", "dc=abc,dc=com", etc
    lc_ldap_group_base_dn: "<Required>"

    ## The LDAP group name attribute.  One possible value is "*:cn" for TDS and "*:cn" for AD. Refer to Knowledge Center for more info.
    lc_ldap_group_name_attribute: "*:cn"

    ## The LDAP group display name attribute.  One possible value for both TDS and AD is "cn". Refer to Knowledge Center for more info.
    lc_ldap_group_display_name_attr: "cn"

    ## The LDAP group membership search filter string.  One possible value is "(|(&(objectclass=groupofnames)(member={0}))(&(objectclass=groupofuniquenames)(uniquemember={0})))" for TDS
    ## and "(&(cn=%v)(objectcategory=group))" for AD.
    lc_ldap_group_membership_search_filter: "<Required>"

    ## The LDAP group membership ID map.  One possible value is "groupofnames:member" for TDS and "memberOf:member" for AD.
    lc_ldap_group_member_id_map: "<Required>"

    ## Set to true if you want to enable LDAP nested search in IAM, by default it is false
    lc_ldap_recursive_search: false

    ## Set to true if you want to enable LDAP pagination in IAM, by default it is false
    lc_enable_pagination: false

    ## If lc_enable_pagination is set to true, then specify the pagination size. If not specified, the following default values will be used:
    ## IBM Tivoli Directory Server: 20000; Microsoft Active Directory:1000, and Custom: 4500
    lc_pagination_size: 1000

    ## add custom group search bases to IAM
    lc_group_searchbase_list: []

    ## add custom user search bases to IAM
    lc_user_searchbase_list: []

    ## The lc_ldap_precheck parameter is used to enable or disable LDAP connection check.
    ## If set to "true", then LDAP connection check will be enabled.
    ## if set to "false", then LDAP connection check will not be enabled.
    # lc_ldap_precheck: true

    ## The User script will uncomment the section needed based on user's input from User script.  If you are deploying without the User script,
    ## uncomment the necessary section (depending if you are using Active Directory (ad) or Tivoli Directory Service (tds)) accordingly.
    # ad:
    #   lc_ad_gc_host: "<Required>"
    #   lc_ad_gc_port: "<Required>"
    #   lc_user_filter: "(&(sAMAccountName=%v)(objectcategory=user))"
    #   lc_group_filter: "(&(cn=%v)(objectcategory=group))"
    # tds:
    #   lc_user_filter: "(&(cn=%v)(objectclass=person))"
    #   lc_group_filter: "(&(cn=%v)(|(objectclass=groupofnames)(objectclass=groupofuniquenames)(objectclass=groupofurls)))"
    # custom:
    #   lc_user_filter: "(&(objectClass=person)(cn=%v))"
    #   lc_group_filter:  "(&(objectClass=group)(cn=%v))"

    ## This is to add customized IAM SCIM LDAP attributes for this LDAP configuration, If you only add 'scim_configuration_iam', we will create SCIM LDAP attributes mapping using default values and the default value meant for IBM Security Directory Server only. Comment the whole section if you don't want this to be configured.
    # scim_configuration_iam:
    #   ## This attribute MUST be set to an LDAP attribute that is unique and immutable
    #   user_unique_id_attribute: dn
    #   user_external_id_attribute: dn
    #   user_emails_attribute: mail
    #   user_name_attribute: uid
    #   user_display_name_attribute: cn
    #   user_groups_attribute: memberOf
    #   user_object_class_attribute: person
    #   user_principal_name_attribute: uid
    #   user_given_name_attribute: cn
    #   user_family_name_attribute: sn
    #   user_full_name_attribute: cn
    #   ## Optional:  Uncomment 'user_custom_mapping' and add any custom mapping below
    #   # user_custom_mapping:
    #     # <scim_attr_name> : <ldap attr name>
    #     # like below
    #     # ibmentryuuid : ibm-entryuuid
    #   ## This attribute MUST be set to an LDAP attribute that is unique and immutable
    #   group_unique_id_attribute: dn
    #   group_external_id_attribute: dn
    #   group_display_name_attribute : cn
    #   group_members_attribute: member
    #   group_object_class_attribute: groupOfNames
    #   group_name_attribute: cn
    #   group_principal_name_attribute: cn
    #   ## Optional:  Uncomment 'group_custom_mapping' and add any custom mapping below
    #   # group_custom_mapping:
    #     # <scim_attr_name> : <ldap attr name>
    #     # like below
    #     # ibmentryuuid : ibm-entryuuid

    ## This section allows to enhance the ldap configuration for the UMS SCIM capability. If lc_user_filter or lc_group_filter cannot handle a custom LDAP filter for user or group searches this section should be enabled.
    ## optional: enables the liberty ldapEntityType configuration and disables the usage of lc_user_filter, lc_group_filter, lc_ldap_group_member_id_map, lc_ldap_user_name_attribute and lc_ldap_group_name_attribute in the UMS capabilities.
    ## for detailed information about the ldapEntityType, loginProperty and groupProperties  parameters please see the liberty documentation: https://www.ibm.com/docs/en/was-liberty/nd?topic=configuration-ldapregistry
    ## default is false
    lc_use_ldap_entity_type:
    ## optional: only used if lc_use_ldap_entity_type is true
    ## default is uid
    lc_ldap_login_property:
    ## optional: only used if lc_use_ldap_entity_type is true
    ## the defaults depends on the lc_selected_ldap_type
    lc_ldap_entity_type_user:
      object_class:
      search_base:
      search_filter:
    ## optional: only used if lc_use_ldap_entity_type is true
    ## the defaults depends on the lc_selected_ldap_type
    lc_ldap_entity_type_group:
      object_class:
      search_base:
      search_filter:
    ## optional: only used if lc_use_ldap_entity_type is true
    ## the defaults depends on the lc_selected_ldap_type
    lc_ldap_group_properties:
      # member_attribute:
        # The name of the member. Required if member_attribute is set
        # name:
        # The name of the object class. Required member_attribute is set
        # object_class:
        ## the scope options are: all, direct, nested
        # scope:
      #membership_attribute:
        # The name of the membership. Required if membership_attribute is set
        # name:
        ## the scope options are: all, direct, nested
        # scope:

  ## The beginning section of multi ldap configuration for CP4BA
  # ldap_configuration_<id_name>:
    #lc_ldap_id: <id_name>
    ## The possible values are: "IBM Security Directory Server" or "Microsoft Active Directory" or "Custom"
    #lc_selected_ldap_type: "<Required>"

    ## The name of the LDAP server to connect
    #lc_ldap_server: "<Required>"

    ## The port of the LDAP server to connect.  Some possible values are: 389, 636, etc.
    #lc_ldap_port: "<Required>"

    ## The LDAP base DN.  For example, "dc=example,dc=com", "dc=abc,dc=com", etc
    #lc_ldap_base_dn: "<Required>"

    ## Enable SSL/TLS for LDAP communication. Refer to Knowledge Center for more info.
    #lc_ldap_ssl_enabled: true

    ## The name of the secret that contains the LDAP SSL/TLS certificate.
    #lc_ldap_ssl_secret_name: "<Required>"

    ## The LDAP user name attribute.  One possible value is "*:cn" for TDS and "user:sAMAccountName" for AD. Refer to Knowledge Center for more info.
    #lc_ldap_user_name_attribute: "<Required>"

    ## The LDAP user display name attribute. One possible value is "cn" for TDS and "sAMAccountName" for AD. Refer to Knowledge Center for more info.
    #lc_ldap_user_display_name_attr: "<Required>"

    ## The LDAP group base DN.  For example, "dc=example,dc=com", "dc=abc,dc=com", etc
    #lc_ldap_group_base_dn: "<Required>"

    ## The LDAP group name attribute.  One possible value is "*:cn" for TDS and "*:cn" for AD. Refer to Knowledge Center for more info.
    #lc_ldap_group_name_attribute: "*:cn"

    ## The LDAP group display name attribute.  One possible value for both TDS and AD is "cn". Refer to Knowledge Center for more info.
    #lc_ldap_group_display_name_attr: "cn"

    ## The LDAP group membership search filter string.  One possible value is "(|(&(objectclass=groupofnames)(member={0}))(&(objectclass=groupofuniquenames)(uniquemember={0})))" for TDS and AD
    #lc_ldap_group_membership_search_filter: "<Required>"

    ## The LDAP group membership ID map.  One possible value is "groupofnames:member" for TDS and "memberOf:member" for AD.
    #lc_ldap_group_member_id_map: "<Required>"

    ## The lc_ldap_precheck parameter is used to enable or disable LDAP connection check.
    ## If set to "true", then LDAP connection check will be enabled.
    ## if set to "false", then LDAP connection check will not be enabled.
    # lc_ldap_precheck: true

    ## Uncomment the necessary section (depending if you are using Active Directory (ad) or Tivoli Directory Service (tds) or custom for other LDAP type) accordingly.
    #ad:
    #  lc_ad_gc_host: "<Required>"
    #  lc_ad_gc_port: "<Required>"
    #  lc_user_filter: "(&(sAMAccountName=%v)(objectcategory=user))"
    #  lc_group_filter: "(&(cn=%v)(objectcategory=group))"
    #tds:
    #  lc_user_filter: "(&(cn=%v)(objectclass=person))"
    #  lc_group_filter: "(&(cn=%v)(|(objectclass=groupofnames)(objectclass=groupofuniquenames)(objectclass=groupofurls)))"
    #custom:
    #  lc_user_filter: "(&(objectClass=person)(cn=%v))"
    #  lc_group_filter:  "(&(objectClass=group)(cn=%v))"

    ## This is to add customized IAM SCIM LDAP attributes for this LDAP configuration, If you only add 'scim_configuration_iam', we will create SCIM LDAP attributes mapping using default values and the default value meant for IBM Security Directory Server only. Comment the whole section if you don't want this to be configured.
    # scim_configuration_iam:
    #   ## This attribute MUST be set to an LDAP attribute that is unique and immutable
    #   user_unique_id_attribute: dn
    #   user_external_id_attribute: dn
    #   user_emails_attribute: mail
    #   user_name_attribute: uid
    #   user_display_name_attribute: cn
    #   user_groups_attribute: memberOf
    #   user_object_class_attribute: person
    #   user_principal_name_attribute: uid
    #   user_given_name_attribute: cn
    #   user_family_name_attribute: sn
    #   user_full_name_attribute: cn
    #   ## Optional:  Uncomment 'user_custom_mapping' and add any custom mapping below
    #   # user_custom_mapping:
    #     # <scim_attr_name> : <ldap attr name>
    #     # like below
    #     # ibmentryuuid : ibm-entryuuid
    #   ## This attribute MUST be set to an LDAP attribute that is unique and immutable
    #   group_unique_id_attribute: dn
    #   group_external_id_attribute: dn
    #   group_display_name_attribute : cn
    #   group_members_attribute: member
    #   group_object_class_attribute: groupOfNames
    #   group_name_attribute: cn
    #   group_principal_name_attribute: cn
    #   ## Optional:  Uncomment 'group_custom_mapping' and add any custom mapping below
    #   # group_custom_mapping:
    #     # <scim_attr_name> : <ldap attr name>
    #     # like below
    #     # ibmentryuuid : ibm-entryuuid

  ########################################################################
  ########   IBM Business Automation Workflow Authoring configuration     ########
  ########################################################################
  workflow_authoring_configuration:

    ibm_workplace_job:
      ## Workflow Authoring IBM Workplace deployment job image repository URL
      repository: cp.icr.io/cp/cp4a/baw/iaws-ibm-workplace
      ## Workflow Authoring IBM Workplace deployment job image repository tag.
      tag: "24.0.0-IF001"
      ## Pull policy for Workflow Authoring IBM Workplace deployment job image. Default value is IfNotPresent. Possible values are IfNotPresent, Always.
      pull_policy: IfNotPresent

    ## storage configuration
    storage:
      ## Set to true to use dynamic storage provisioning. If set to false, you must set existing_pvc_for_logstore and existing_pvc_for_dumpstore.
      use_dynamic_provisioning: true
      ## Persistent volume claim (PVC) for generic files.
      existing_pvc_for_filestore: ""
      ## Minimum size of the persistent volume (PV) that is mounted as the generic file store.
      size_for_filestore: "1Gi"

    ## customize environment settings
    environment_config:
      ## Whether to show the Intelligent Task Prioritization service toggle button in the web user interface to allow the user to enable or disable this service.
      show_task_prioritization_service_toggle: false
      ## Whether to display the Intelligent Task Prioritization service toggle button. If this parameter is set to true, the previous parameter is ignored.
      always_run_task_prioritization_service: false
      csrf:
        ## Acceptable values in the Origin header field. The value of this property must be a comma-separated list of prefixes in the format protocol://host:port, e.g "https://example.com, http://example2.com:8080".
        origin_allowlist:
        ## Acceptable values in the Referer header field. The value of this property must be a comma-separated list of fully qualified host names, e.g "example1.com, example2.com".
        referer_allowlist:
      ## Content security policy additional directive for default-src , e.g. ["https://hostname1","https://hostname2"]
      content_security_policy_additional_default_src: []
      ## Content security policy additional directive for script-src , e.g. ["https://hostname1","https://hostname2"]
      content_security_policy_additional_script_src: []
      ## Content security policy additional directive for frame-src , e.g. ["https://hostname1","https://hostname2"]
      content_security_policy_additional_frame_src: []
      ## Content security policy additional directive for object-src , e.g. ["https://hostname1","https://hostname2"]
      content_security_policy_additional_object_src: []
      ## Content security policy additional directive for connect-src , e.g. ["https://hostname1","https://hostname2"]
      content_security_policy_additional_connect_src: []
      ## Content security policy additional directive for frame-ancestor, e.g. ["https://hostname1","https://hostname2"]
      content_security_policy_additional_frame_ancestor: []
      ## Content security policy additional directive for img-src, e.g. ["https://hostname1","https://hostname2"]
      content_security_policy_additional_img_src: []
      ## Content security policy additional directive for font-src, e.g. ["https://hostname1","https://hostname2"]
      content_security_policy_additional_font_src: []
      ## Content security policy additional directive for style-src, e.g. ["https://hostname1","https://hostname2"]
      content_security_policy_additional_style_src: []

    ## JVM options separated with spaces, for example: -Dtest1=test -Dtest2=test2.
    jvm_customize_options:

    ##  Workflow Authoring custom plain XML snippet
    ##  liberty_custom_xml: |+
    ##    <server>
    ##      <!-- custom propeties here -->
    ##    </server>
    ## The custom_xml_secret_name is also used for Workflow Authoring customization. Ensure the configuration value exists either in liberty_custom_xml or custom_xml_secret_name.
    ## Do not set the configuration value in both places.
    liberty_custom_xml:

    ## Workflow Authoring custom XML secret name that contains custom configuration in Liberty server.xml,
    ## put the custom.xml in secret with key "sensitiveCustomConfig"
    ## kubectl create secret generic wfs-custom-xml-secret --from-file=sensitiveCustomConfig=./custom.xml
    ## The liberty_custom_xml property is also used for Workflow Authoring customization. Ensure the configuration value exists either in liberty_custom_xml or custom_xml_secret_name.
    ## Do not set the configuration value in both places
    custom_xml_secret_name:

    ## Workflow Authoring Lombardi custom XML secret name that contains custom configuration in 100Custom.xml
    ## put the 100Custom.xml in secret with key "sensitiveCustomConfig"
    #  kubectl create secret generic wfs-lombardi-custom-xml-secret --from-file=sensitiveCustomConfig=./100Custom.xml
    lombardi_custom_xml_secret_name:

    ##  IBM Business Automation Insights integration configuration
    business_event:
      ## Whether to enable event monitoring for Dynamic Event Framework events for the Workflow Services container.
      ## If Business Automation Insights and the Machine Learning Server parameters are configured, this parameter must be set to true.
      enable: false
      ## Whether to enable the task record in generated events. This optional parameter is equivalent to the task-record-enabled parameter,
      ## Also see https://www.ibm.com/support/knowledgecenter/SSYHZ8_20.0.x/com.ibm.dba.bai/topics/ref_bai_bpmn_summary_formats.html
      enable_task_record: true
      ## Whether to record additional task information in generated events.
      ## If Business Automation Insights and the Machine Learning Server parameters are configured, this parameter must be set to true.
      ## This parameter is equivalent to the enable_task_api_def parameter.
      ## Also see https://www.ibm.com/support/knowledgecenter/SSYHZ8_20.0.x/com.ibm.dba.bai/topics/ref_bai_bpmn_summary_formats.html
      enable_task_api: false
      ## List of the subscription configurations. Each subscription attribute is listed in the rest of this table.
      ## app_name: Name of the application that is the source of the events that are to be monitored.
      ## version: Version of the application to be monitored.
      ## component_type: Type of the component to be monitored.
      ## component_name: Name of the component to be monitored.
      ## element_type: Type of element to be monitored. BPMN types are PROCESS, ACTIVITY, EVENT, and GATEWAY.
      ## element_name: Name of the element to be monitored.
      ## nature: Nature of the event. One element can send events of various natures, such as STARTED, ACTIVE, COMPLETED.
      ##         The BPMN nature categories are STARTED, COMPLETED, TERMINATED, DELETED, FAILED, CAUGHT, THROWN, EXPECTED, ACTIVE, READY, RESOURCE_ASSIGNED, ACTIVE, LOOP_CONDITION_TRUE, LOOP_CONDITION_FALSE, and MULTIPLE_INSTANCES_STARTED.
      subscription:
      - {'app_name': '*','version': '*','component_type': '*','component_name': '*','element_type': '*','element_name': '*','nature': '*'}

    elasticsearch:
      ## Required only when you want to use external elasticsearch/opensearch for "data collector and data indexer" function. Endpoint of external elasticsearch/opensearch, such as: https://<external_es_host>:<external_es_port>.
      endpoint: ""
      ## Required only when you want to use external elasticsearch/opensearch for "data collector and data indexer" function. The external elasticsearch/opensearch administrative secret that contains the keys: username and password.
      ## If your instance does not have basic authentication, leave this parameter empty.
      admin_secret_name: ""
      ## Optionally specify the number of seconds for elasticsearch/opensearch connection timeout.
      connect_timeout: 10s
      ## Optionally specify the number of seconds for elasticsearch/opensearch read timeout.
      read_timeout: 30s
      ## Optionally specify elasticsearch/opensearch thread count.
      thread_count: 0
      ## Optionally specify the maximum number of connections allowed across all routes when workflow process service connects to the elasticsearch/opensearch cluster to call its REST API.
      ## Specify a positive integer. If the provided value is less than or equal to 0, then the default Elasticsearch/Opensearch High Level REST Client value will be used.
      max_connection_total: -1
      ## Optionally specify the maximum number of connections allowed for a route when workflow process service connects to the elasticsearch/opensearch cluster to call its REST API.
      ## Specify a positive integer. If the provided value is less than or equal to 0, then the default Elasticsearch/Opensearch High Level REST Client value will be used.
      max_connection_per_route: -1

  #############################################################################
  ## This section contains the BAStudio component configurations              #
  #############################################################################
  bastudio_configuration:
    # For most cases, you don't need to input hostname and port here. They can be calculated with your environment informations
    # And all the endpoints can be visit through unified external URL
    # With none zen mode. If you want to customize external hostname and port. Update values here. They will be used as BA Studio external visit hostname and port.
    # Invalid value will cause BA Studio not working and cannot be visited
    hostname:
    port:
    images:
      pull_policy: IfNotPresent
      bastudio:
        repository: cp.icr.io/cp/cp4a/bas/bastudio
        tag: "24.0.0-IF001"
    #Adjust this one if you created the secret with name other than the default
    admin_secret_name: "{{ meta.name }}-bas-admin-secret"
    #-----------------------------------------------------------------------
    # bastudio admin Secret template will be
    #-----------------------------------------------------------------------
    # apiVersion: v1
    # stringData:
    #   dbPassword: "<Your database password>"
    #   dbUsername: "<Your database username>"
    # kind: Secret
    # metadata:
    #   name: icp4adeploy-bas-admin-secret
    # type: Opaque
    #----------------------------------------
    # Designate an existing LDAP user for the BAStudio and WPS authoring repostiory admin user.
    # If not provided. Then the default IAM admin user will be used as the default admin user ID.
    # You can get that from secret ibm-iam-bindinfo-platform-auth-idp-credentials
    admin_user:  ""
    replica_size: 1
    database:
      # Operator will now have a capability to automatically provision an EDBPostgres instance upon request for Production/Enterprise deployment
      # If you want PostgresDB to be created for a bastudio database, set this parameter to true
      # When you set dc_use_postgres to true, please ensure that the fields for host, port, and certificate_secret_name are left empty, and also set ssl_enabled to true.
      dc_use_postgres: false
      # The database type used. Only PostgreSQL supported
      type: "PostgreSQL"
      # PostgreSQL - Provide the database server hostname for BAStudio use, for example, wfpsdb
      host: "<Required>"
      # PostgreSQL - Provide the database name for BAStudio use
      # The database provided should be created by the BAStudio SQL script template.
      name: "<Required>"
      # PostgreSQL - Provide the database server port for BAStudio use
      port: "<Required>"
      # If you want to enable PostgreSQL Connection Fail-over, you must configure alternative_host and alternative_port. Otherwise, leave them blank.
      alternative_host:
      alternative_port:
      # Enabled SSL for Database is true by default
      ssl_enabled: true
      cm_max_pool_size: '50'
      cm_min_pool_size: '2'
      # Enabled the SSL for database is true by default. Please save the TLS certificate used by database in a secret and put the name here
      certificate_secret_name: <Required>
      # Default is false. If you are using custom JDBC. Then you must set shared_configuration.sc_drivers_url and change this value to true.
      use_custom_jdbc_drivers: false
      # The custom JDBC file set. If you are using Custom JDBC. Input your PostgreSQL JDBC jar files here. Like: postgresql-42.2.16.jar
      jdbc_driver_files: ""
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 3
      targetAverageUtilization: 80
    external_connection_timeout: 60s
    # Custom liberty XML configurations
    custom_xml:
    # The secret name which contain custom liberty configurations
    custom_secret_name:
    # The Business Automation Custom XML configurations
    bastudio_custom_xml:
    # If you don't want to use walkme script. You can set this one to false
    use_walkme: true
    max_cached_objects_during_refactoring: 256
    logs:
      # You can find all possible options for this section on liberty document
      # https://www.ibm.com/support/knowledgecenter/SSEQTP_liberty/com.ibm.websphere.liberty.autogen.base.doc/ae/rwlp_config_logging.html
      consoleFormat: 'json'
      consoleLogLevel: 'INFO'
      consoleSource: 'message,trace,accessLog,ffdc,audit'
      traceFormat: 'ENHANCED'
      traceSpecification: '*=info'
      messageFormat: 'SIMPLE'
      max_files: '2'
      max_file_size: '20'
    tls:
      tlsTrustList: []
    liveness_probe:
      initialDelaySeconds: 300
      periodSeconds: 30
      timeoutSeconds: 5
      failureThreshold: 3
      successThreshold: 1
    readiness_probe:
      initialDelaySeconds: 240
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 5
      successThreshold: 1
    startup_probe:
      period_seconds: 5
      timeout_seconds: 10
      failure_threshold: 120
      success_threshold: 1
    resources:
      bastudio:
        limits:
          cpu: '2'
          memory: '3072Mi'
        requests:
          cpu: '1100m'
          memory: '1752Mi'
      init_process:
        limits:
          cpu: '500m'
          memory: '512Mi'
        requests:
          cpu: '100m'
          memory: '128Mi'
    csrf_referrer:
      allowlist: ''
    # Content Security Policy directory folder settings. We will add our required CSP folders in default setting
    # If you require any extra settings for those content security policy directory folder setting.
    # Set them here
    additional_csp_folders:
      # Folder for setting default-src. For example: ['host1','host2']
      default_src: []
      # Folder for setting script-src. For example: ['host1','host2']
      script_src: []
      # Folder for setting frame-src. For example: ['host1','host2']
      frame_src: []
      # Folder for setting object-src. For example: ['host1','host2']
      object_src: []
      # Folder for setting connect-src. For example: ['host1','host2']
      connect_src: []
      # Folder for setting frame-ancestors. For example: ['host1','host2']
      frame_ancestors: []
      # Folder for setting image-src. For example: ['host1','host2']
      img_src: []
      # Folder for setting font-src. For example: ['host1','host2']
      font_src: []
      # Folder for setting style-src. For example: ['host1','host2']
      style_src: []
    environment_config:
      # Two authorization modes are provided for the REST APIs granting access to user, group, and team information.
      # false -- mode provides limited authorization control
      # true -- an enhanced mode is available to extend authorization control to all concerned APIs.
      authorization_enabled_for_org_info: "true"
      csrf:
        ## Comma-separated list of user agents. For the REST API requests with the path pattern "/rest/bpm/wle/v1/*" that is sent by the agents in the list, the server will not validate the "XSRF-TOKEN" cookie. The value of this property must be a comma-separated list, e.g "agentkeyworkd1, agentkeyworkd2".
        user_agent_keyword_allow_list_for_old_restapi_csrf_check: "java,wink client,httpclient,curl,jersey,httpurlconnection"
        ## Whether to validate the cookie "XSRF-TOKEN" against incoming REST API requests (POST/PUT/DELETE) with the path pattern "/rest/bpm/wle/v1/*". The value must be "true" or "false".
        check_xsrf_for_old_restapi: "true"
    storage:
      # Main switch for the data persistence of BAStudio
      enabled: "true"
      # PVC name used to store the BAStudio server log
      existing_pvc_for_logstore: "cp4a-shared-log-pvc"
      # Size of the PV to store the BAStudio server log. Used when creating the PVC
      size_for_logstore: "10Gi"
      # PVC name used to store the BAStudio server dump files
      existing_pvc_for_dumpstore: "{{ meta.name }}-bastudio-dump-pvc"
      # Size of the PV to store the BAStudio server dump files. Used when creating the PVC
      size_for_dumpstore: "10Gi"
      # storage class name used for the PVC when not availble
      storage_class: "{{ shared_configuration.storage_configuration.sc_fast_file_storage_classname }}"
      # Size of the PV to store the BAStudio server index files. Used when creating the PVC
      size_for_index: "10Gi"
      # storage class name used for the BAStudio server index PVC
      block_storage_class: "{{ shared_configuration.storage_configuration.sc_block_storage_classname }}"
    jms_server:
      storage:
        ## Whether to enable persistent storage for JMS
        persistent: true
        ## Size for JMS persistent storage
        size: "1Gi"
        ## Whether to enable dynamic provisioning for JMS persistent storage
        use_dynamic_provisioning: true
        ## Access modes for JMS persistent storage
        access_modes:
        - ReadWriteOnce
        ## Storage class name for JMS persistent storage
        storage_class: "{{ shared_configuration.storage_configuration.sc_fast_file_storage_classname }}"
    node_affinity:
      # Value in this field will be used as kubernetes.io/arch selector values. By default all support arch will be included
      # It will be transformed to node selector value
      # - key: kubernetes.io/arch
      #   operator: In
      #   values:
      #     - amd64
      #     - s390x
      #     - ppc64le
      deploy_arch:
      - amd64
      - s390x
      - ppc64le
      #-------------------------------------
      # custom_node_selector_match_expression will be added in node selector match expressions.
      # It accept array list inputs. You can assign mutiple selector match expressions except (kubernetes.io/arch)
      # Example value:
      # - key: kubernetes.io/hostname
      #   operator: In
      #   values:
      #     - worker0
      #     - worker1
      #     - worker3
      #-------------------------------------
      custom_node_selector_match_expression: []
    # Values in this field will be used as annotations in all generated pods
    # It must be valid annotation key value pairs
    # Example:
    # customAnnotationKey: customAnnotationValue
    custom_annotations: {}
    # Values in this field will be used as labels in all generated pods
    # It must be valid label key value pairs
    # Example:
    # customLabelKey: customLableValue
    custom_labels: {}
